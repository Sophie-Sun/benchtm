<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate new outcome data for existing covariates • benchtm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generate new outcome data for existing covariates">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">benchtm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_User_guidance.html">Get started with benchtm</a>
    </li>
    <li>
      <a href="../articles/a02_Examples_Real_Data.html">Generate new outcome data for existing covariates</a>
    </li>
    <li>
      <a href="../articles/a03_Examples_Simulation.html">Using benchtm for a Simulation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Generate new outcome data for existing covariates</h1>
            
      
      
      <div class="hidden name"><code>a02_Examples_Real_Data.Rmd</code></div>

    </div>

    
    
<div id="data-generation-using-benchtm-based-on-real-clinical-data" class="section level2">
<h2 class="hasAnchor">
<a href="#data-generation-using-benchtm-based-on-real-clinical-data" class="anchor"></a>Data Generation using “benchtm” Based on Real Clinical Data</h2>
<p>In this section we demonstrate how to use “benchtm” package for reproducible data analysis using real clinical data. The package can generate outcomes based on user-specific covariates. This would allow users to perform simulation study using real data as inputs and validate existing findings. For example it allows to simulate data for the scenario under no treatment effect heterogeneity (no treatment by covariate interaction). The simulated data can then be analysed in the same way as the original data. This will allow to put potential finding on the original data into context (e.g. how consistent are analysis results with the hypothesis of no treatment by covariate interactions).</p>
<p>As demonstration, we will use data from <a href="http://portal.uni-freiburg.de/imbi/Royston-Sauerbrei-book">Prostate cancer patients</a>. The treatment consisted of a placebo group and three dose levels of diethyl stilbestrol. The placebo and the lowest dose level of diethyl stilbestrol were combined to give the control arm, and the higher doses were combined to give an active treatment arm. Of 506 patients randomized, only 475 with complete data are available on the dataset. Based on the analysis provided in <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1002/bimj.201500147">Exploratory subgroup analysis in clinical trials by model selection</a>, we only consider Bone metastasis (BM), History of cardiovascular disease (HX), and Age (AGE &gt; 65) as covariates. The endpoint is survival time (SURVTIME) with censoring (CENS = 1:death; CENS = 0 censor). Treatment is recoded as RX.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(benchtm)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(clustMD)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(survival)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(haven)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">## BM:Bone metastasis, </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">## HX:History of cardiovascular disease</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">## AGE:Age, years based on model; </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">## RX:treatment</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">## SURVTIME: survival time, </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">## CENS: 0 for censor and 1 for death </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">## reference https://onlinelibrary.wiley.com/doi/10.1002/bimj.201500147</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">dat &lt;-<span class="st"> </span><span class="kw"><a href="https://haven.tidyverse.org/reference/read_sas.html">read_sas</a></span>(<span class="st">"adv_prostate_ca.sas7bdat"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">  </span>## the SAS data in provided in https://onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fbimj.201500147&amp;file=bimj1691-sup-0001-CodeData.zip</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">  </span><span class="kw">select</span>(BM, HX, AGE, SURVTIME, CENS, RX) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AGE_cat =</span> <span class="dv">1</span><span class="op">*</span>(AGE <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>))</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dat)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; # A tibble: 6 x 7</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt;      BM    HX   AGE SURVTIME  CENS    RX AGE_cat</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; 1     0     0    75     72.5     0     0       1</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; 2     0     1    69     40.5     1     1       1</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; 3     0     1    75     20.5     1     0       1</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; 4     0     0    67     65.5     0     0       1</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; 5     0     0    71     24.5     1     0       1</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; 6     0     0    75     46.5     1     0       1</span></a></code></pre></div>
<p>A survival model is fitted assuming exponential distribution. Model with and without interactions are conducted respectively.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">## fit main model (just main/prognostic effects)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">model.main =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/survreg">survreg</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(SURVTIME, CENS) <span class="op">~</span><span class="st"> </span>RX <span class="op">+</span><span class="st"> </span>BM <span class="op">+</span><span class="st"> </span>HX <span class="op">+</span><span class="st"> </span>AGE_cat, <span class="dt">dist =</span> <span class="st">"exponential"</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                   <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model.main)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; survreg(formula = Surv(SURVTIME, CENS) ~ RX + BM + HX + AGE_cat, </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;     data = dat, dist = "exponential")</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;              Value Std. Error     z       p</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; (Intercept)  4.376      0.161 27.22 &lt; 2e-16</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; RX           0.193      0.112  1.73   0.084</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; BM          -0.719      0.140 -5.15 2.7e-07</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; HX          -0.465      0.110 -4.21 2.5e-05</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; AGE_cat     -0.269      0.152 -1.76   0.078</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; Scale fixed at 1 </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; Exponential distribution</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; Loglik(model)= -1644.3   Loglik(intercept only)= -1667</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;  Chisq= 45.35 on 4 degrees of freedom, p= 3.4e-09 </span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; Number of Newton-Raphson Iterations: 4 </span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; n= 475</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">## model with interactions</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">model.inter =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/survreg">survreg</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(SURVTIME, CENS) <span class="op">~</span><span class="st"> </span>RX <span class="op">*</span><span class="st"> </span>(BM <span class="op">+</span><span class="st">  </span>HX <span class="op">+</span><span class="st">  </span>AGE_cat), </a>
<a class="sourceLine" id="cb2-26" data-line-number="26">                      <span class="dt">dist =</span> <span class="st">"exponential"</span>,</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">                   <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model.inter)</a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt; survreg(formula = Surv(SURVTIME, CENS) ~ RX * (BM + HX + AGE_cat), </span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt;     data = dat, dist = "exponential")</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="co">#&gt;              Value Std. Error     z       p</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt; (Intercept)  4.030      0.189 21.29 &lt; 2e-16</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt; RX           0.897      0.309  2.90  0.0037</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt; BM          -1.083      0.199 -5.44 5.4e-08</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt; HX          -0.347      0.151 -2.30  0.0217</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt; AGE_cat      0.130      0.193  0.67  0.5027</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt; RX:BM        0.603      0.276  2.19  0.0288</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt; RX:HX       -0.268      0.220 -1.22  0.2242</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt; RX:AGE_cat  -0.810      0.315 -2.57  0.0100</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co">#&gt; Scale fixed at 1 </span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co">#&gt; Exponential distribution</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="co">#&gt; Loglik(model)= -1636.8   Loglik(intercept only)= -1667</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">#&gt;  Chisq= 60.29 on 7 degrees of freedom, p= 1.3e-10 </span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48"><span class="co">#&gt; Number of Newton-Raphson Iterations: 4 </span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="co">#&gt; n= 475</span></a></code></pre></div>
<p>From the main model, we can see that Bone metastasis (BM), History of cardiovascular disease (HX) are significant under exponential assumption, with interaction included, we can see that Bone metastasis (BM) and Age have significant interaction with treatment (P-value &lt; 0.05). Based on the point estimates from the interaction model, we could use “benchtm” package to generate new outcomes based on the existing covariates in this dataset.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(survminer)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># coefficients obtained from model.inter</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">prog_use &lt;-<span class="st"> " -4.030 +1.0830 *BM + 0.347 *HX - 0.13*AGE_cat"</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">pred_use &lt;-<span class="st"> "-0.603 * BM + 0.27 * HX + 0.81 * AGE_cat"</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">b0_use &lt;-<span class="st"> </span><span class="fl">-0.897</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">b1_use &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">dat_generate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_y.html">generate_y</a></span>(<span class="dt">X =</span> dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BM, HX, AGE_cat), <span class="dt">trt =</span> dat<span class="op">$</span>RX, </a>
<a class="sourceLine" id="cb3-12" data-line-number="12">                           <span class="dt">prog =</span> prog_use, <span class="dt">pred =</span> pred_use, <span class="dt">b0 =</span> b0_use, <span class="dt">b1 =</span> b1_use,</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">                          <span class="dt">type =</span> <span class="st">"survival"</span>, <span class="dt">cens_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(dat<span class="op">$</span>SURVTIME))</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dat_generate)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;   trt BM HX AGE_cat         Y event</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; 1   0  0  0       1 48.385650     1</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 2   1  0  1       1 44.563077     1</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 3   0  0  1       1  6.598488     1</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; 4   0  0  0       1  8.956895     1</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; 5   0  0  0       1 27.939581     1</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt; 6   0  0  0       1 76.500000     0</span></a></code></pre></div>
<p>To check if the generated data is close to the real data, a Kaplan-Meier curve can be used to compare the survival probabilities.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dat_combine &lt;-<span class="st"> </span>dat_generate <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Y, event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">SURVTIME =</span> Y, <span class="dt">CENS =</span> event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SURVTIME, CENS)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="dt">cat =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Generated"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dat)[<span class="dv">1</span>]),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Observed"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dat)[<span class="dv">1</span>])))</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">## compare ovserved and generated survival time </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/survfit">survfit</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(SURVTIME, CENS) <span class="op">~</span><span class="st"> </span>cat, <span class="dt">data =</span> dat_combine)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/survminer/topics/ggsurvplot">ggsurvplot</a></span>(fit, <span class="dt">data =</span> dat_combine, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">palette =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#E7B800"</span>, <span class="st">"#2E9FDF"</span>), </a>
<a class="sourceLine" id="cb4-9" data-line-number="9">          <span class="dt">conf.int =</span> <span class="ot">TRUE</span>,  <span class="dt">pval =</span> <span class="ot">TRUE</span>,  <span class="dt">risk.table =</span> <span class="ot">TRUE</span>,  <span class="dt">risk.table.col =</span> <span class="st">"strata"</span>,</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">          <span class="dt">legend.labs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Generated"</span>, <span class="st">"Observed"</span>),  <span class="dt">risk.table.height =</span> <span class="fl">0.25</span>,  </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">          <span class="dt">ggtheme =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">)</a></code></pre></div>
<p><img src="a02_Examples_Real_Data_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We can see from the above plot that the generated survival times have very similar distribution compared to the observed survival times.</p>
</div>
<div id="heterogeneity-test-using-benchtm" class="section level2">
<h2 class="hasAnchor">
<a href="#heterogeneity-test-using-benchtm" class="anchor"></a>Heterogeneity Test using “benchtm”</h2>
<p>One can also conduct a parametric bootstrap test for existence of treatment effect heterogeneity by calculating the log-likelihood ratio under the model with and without interation. The null distribution of this statistic can be simulated by simulating new data from the model without treatment by covariate interactions (model <code>model,main</code> above).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># loglikehood ratios from 100 datasets generated from null model</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">loglikratio_null &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="cf">function</span>(seed){</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(seed)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="co"># prog and pred are based on main model without interaction</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  dat_generate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_y.html">generate_y</a></span>(<span class="dt">X =</span> dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BM, HX, AGE_cat), <span class="dt">trt =</span> dat<span class="op">$</span>RX, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                             <span class="dt">prog =</span> <span class="st">"-4.376 +0.719 *BM + 0.465 *HX +0.269*AGE_cat"</span>, </a>
<a class="sourceLine" id="cb5-7" data-line-number="7">                             <span class="dt">pred =</span> <span class="st">"0"</span>, <span class="dt">b0 =</span> <span class="fl">-0.193</span>, <span class="dt">b1 =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">                             <span class="dt">type =</span> <span class="st">"survival"</span>, <span class="dt">cens_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(dat<span class="op">$</span>SURVTIME))</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  model.full &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/coxph">coxph</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(Y, event) <span class="op">~</span><span class="st">  </span>trt <span class="op">*</span><span class="st"> </span>(BM <span class="op">+</span><span class="st">  </span>HX <span class="op">+</span><span class="st">  </span>AGE_cat), <span class="dt">data =</span> dat_generate)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  model.null &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/coxph">coxph</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(Y, event) <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>BM <span class="op">+</span><span class="st"> </span>HX <span class="op">+</span><span class="st"> </span>AGE_cat, <span class="dt">data =</span> dat_generate)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  (model.full<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>model.null<span class="op">$</span>loglik)[<span class="dv">2</span>]<span class="op">*</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">})</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">## loglikehood ratio for real data using cox model</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">model.null.obs =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/coxph">coxph</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(SURVTIME, CENS) <span class="op">~</span><span class="st"> </span>RX <span class="op">+</span><span class="st"> </span>BM <span class="op">+</span><span class="st"> </span>HX <span class="op">+</span><span class="st"> </span>AGE_cat, <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">model.full.obs =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/coxph">coxph</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(SURVTIME, CENS) <span class="op">~</span><span class="st">  </span>RX <span class="op">*</span><span class="st"> </span>(BM <span class="op">+</span><span class="st">  </span>HX <span class="op">+</span><span class="st">  </span>AGE_cat), <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">loglikratio_obs &lt;-<span class="st"> </span>(model.full.obs<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>model.null.obs<span class="op">$</span>loglik)[<span class="dv">2</span>]<span class="op">*</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17">result_anova &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/anova">anova</a></span>(model.null.obs, model.full.obs)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">## plot to show the difference </a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">x =</span> loglikratio_null), <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span>x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="dt">alpha=</span>.<span class="dv">4</span>, <span class="dt">fill =</span> <span class="st">"blue"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat_function.html">stat_function</a></span>(<span class="dt">fun =</span> dchisq, <span class="dt">args =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">df =</span> result_anova<span class="op">$</span>Df[<span class="dv">2</span>]), <span class="dt">color =</span> <span class="st">"red"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept =</span> loglikratio_obs, <span class="dt">color =</span> <span class="st">'black'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="dt">geom =</span> <span class="st">'text'</span>, <span class="dt">x =</span> loglikratio_obs, <span class="dt">y =</span> <span class="fl">0.025</span>, <span class="dt">color =</span> <span class="st">'blue'</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">           <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'P(X&gt;obs) ='</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">                          <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(loglikratio_null <span class="op">&gt;</span><span class="st"> </span>loglikratio_obs)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(loglikratio_null)), <span class="dt">hjust =</span> <span class="fl">-0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="dt">geom =</span> <span class="st">'text'</span>, <span class="dt">x =</span> loglikratio_obs, <span class="dt">y =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">'red'</span>,</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">           <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'P(X&gt;obs) ='</span>,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">                          <span class="dv">1</span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Chisquare">pchisq</a></span>(loglikratio_obs, result_anova<span class="op">$</span>Df[<span class="dv">2</span>])), <span class="dt">hjust =</span> <span class="fl">-0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a></code></pre></div>
<p><img src="a02_Examples_Real_Data_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The blue area is the density of the log-likelihood ratios for the model with/without interaction under the data generated from main model. The red line is the density of the chi-squared distribution for the test of interaction v.s. main model from modeling observed data. It can be seen that the empirical density matches the theoretical density well. The black vertical line is the observed log-likelihood ratio for real data. In response to the generated data test, P-value = 0.002, which is similar to the chi-square test (P-value = 0.001), indicating the treatment effect heterogeneity exists(there is interaction effect).</p>
<p>While the procedure here illustrated the approach for a global test for treatment effect heterogeneity, also other statistics could be simulated, for example the treatment effect in an identified subgroup after an algorithmic subgroup search. This simulation approach may be a valuable tool for assessing the strength of evidence for a subgroup finding: One could assess for example how likely it is to find a subgroup with a particular treatment effect in the case of no treatment by covariate interaction.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-generation-using-benchtm-based-on-real-clinical-data">Data Generation using “benchtm” Based on Real Clinical Data</a></li>
      <li><a href="#heterogeneity-test-using-benchtm">Heterogeneity Test using “benchtm”</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sophie Sun, Bjoern Bornkamp, Jiarui Lu, Ardalan Mirshani, Kostas Sechidis, Yao Chen, Novartis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
